version: '3'

tasks:
  fmt:
    desc: Run code formatters using uvx and ruff
    deps: [":build:uv"]
    cmds:
      - printf "${BLUE}[INFO] Running formatters...${RESET}\n"
      - uvx ruff format .
  
  lint:
    desc: Run pre-commit hooks using uvx and pre-commit
    deps: [":build:uv"]
    cmds:
      - printf "${BLUE}[INFO] Running linters...${RESET}\n"
      - uvx pre-commit run --all-files
  
  deptry:
    desc: Run deptry to check for dependency issues
    deps: [":build:uv"]
    cmds:
      - |
        if [ -f "pyproject.toml" ]; then
          printf "${BLUE}[INFO] Running deptry...${RESET}\n"
          SOURCE_FOLDER="src/$(find src -mindepth 1 -maxdepth 1 -type d -not -path '*/\.*' | head -1 | sed 's|^src/||')"
          uvx deptry $SOURCE_FOLDER {{.OPTIONS}}
        else
          printf "${YELLOW}[WARN] No pyproject.toml found, skipping deptry${RESET}\n"
        fi
  
  check:
    desc: Run all checks (lint, fmt, deptry)
    deps: [lint, fmt, deptry]
    cmds:
      - printf "${GREEN}[INFO] All checks passed!${RESET}\n"
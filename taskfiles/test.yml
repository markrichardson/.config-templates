version: '3'

tasks:
  test:
    desc: Run all tests
    deps: [":build:install"]
    cmds:
      - printf "${BLUE}[INFO] Running tests...${RESET}\n"
      - |
        # Create README.md if it doesn't exist
        if [ ! -f "README.md" ]; then
          printf "${BLUE}[INFO] No README.md file found, creating one with '# Hello World' content${RESET}\n"
          echo "# Hello World" > README.md
        fi
        
        # Find source folder
        SOURCE_FOLDER="src/$(find src -mindepth 1 -maxdepth 1 -type d -not -path '*/\.*' | head -1 | sed 's|^src/||')"
        
        if [ -z "$SOURCE_FOLDER" ] || [ -z "{{.TESTS_FOLDER}}" ]; then
          printf "${YELLOW}[WARN] No valid source folder structure found, skipping tests${RESET}\n"
        else
          uv pip install pytest pytest-cov pytest-html
          mkdir -p _tests/html-coverage _tests/html-report
          uv run pytest {{.TESTS_FOLDER}} --cov=$SOURCE_FOLDER --cov-report=term --cov-report=html:_tests/html-coverage --html=_tests/html-report/report.html
        fi